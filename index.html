<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blood Link | Welcome</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variables and Reset */
        :root {
            --primary-color: #e53e3e; /* Blood Link Red */
            --primary-hover: #c53030; /* Darker Red */
            --bg-light: #f8f9fa;
            --bg-dark: #212529;
            --card-bg-light: #ffffff;
            --card-bg-dark: #343a40;
            --text-color-light: #343a40;
            --text-color-dark: #f8f9fa;
            --border-color-light: #e0e0e0;
            --border-color-dark: #495057;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.5);
            --header-bg-light: #ffffff;
            --header-bg-dark: #2a2a2a;
            /* Changed Google button colors to dark gray */
            --google-button-bg: #4a4a4a; /* Dark gray */
            --google-button-hover: #333333; /* Even darker gray on hover */
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-light);
            color: var(--text-color-light);
            transition: background-color 0.4s ease, color 0.4s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Dark Mode Styles */
        body.dark {
            --bg-light: #1a1a1a;
            --bg-dark: #0d0d0d;
            --card-bg-light: #2c2c2c;
            --card-bg-dark: #1f1f1f;
            --text-color-light: #e0e0e0;
            --text-color-dark: #f0f0f0;
            --border-color-light: #3a3a3a;
            --border-color-dark: #555;
            --shadow-light: rgba(0, 0, 0, 0.7);
            --shadow-dark: rgba(0, 0, 0, 0.9);
            --header-bg-light: #2c2c2c;
            --header-bg-dark: #1a1a1a;
            /* Adjusted Google button colors for dark mode */
            --google-button-bg: #666666; /* Slightly lighter gray for dark mode */
            --google-button-hover: #555555;
        }

        /* Global Styles */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* Header */
        header {
            width: 100%;
            background-color: var(--header-bg-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 40px;
            box-shadow: 0 4px 12px var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header .logo-container {
            display: flex;
            align-items: center;
        }

        header img.logo {
            height: 90px;
            margin-right: 15px;
            border-radius: 8px;
        }

        header h1.site-title {
            font-size: 28px;
            color: var(--text-color-light);
            margin: 0;
            font-weight: 700;
        }
        body.dark header h1.site-title {
            color: var(--text-color-dark);
        }

        nav {
            display: flex;
            align-items: center;
        }

        nav a {
            margin-left: 30px;
            text-decoration: none;
            color: var(--text-color-light);
            font-weight: 600;
            font-size: 16px;
            transition: color 0.3s ease;
            position: relative;
        }
         body.dark nav a {
            color: var(--text-color-dark);
        }

        nav a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            display: block;
            margin-top: 5px;
            right: 0;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        nav a:hover::after, nav a.active-nav-link::after {
            width: 100%;
            left: 0;
            background: var(--primary-color);
        }
        nav a:hover, nav a.active-nav-link {
            color: var(--primary-color);
        }

        /* Main Content Area */
        main {
            width: 100%;
            max-width: 960px;
            padding: 40px 20px;
            margin: 40px auto;
            background-color: var(--card-bg-light);
            border-radius: 12px;
            box-shadow: 0 8px 25px var(--shadow-light);
            overflow: hidden;
            position: relative;
        }

        /* Section Transitions */
        section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
            display: none; /* Hidden by default */
        }

        section.active {
            opacity: 1;
            transform: translateY(0);
            display: block; /* Show active section */
        }

        h2.section-heading {
            text-align: center;
            margin-bottom: 35px;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 32px;
        }

        h3, h4 {
            color: var(--text-color-light);
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        body.dark h3, body.dark h4 {
            color: var(--text-color-dark);
        }
        h3 { font-size: 24px; }
        h4 { font-size: 20px; }

        p {
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 15px;
            color: var(--text-color-light);
        }
        body.dark p {
            color: var(--text-color-dark);
        }


        ul.features-list {
            list-style: none;
            padding-left: 0;
            margin-bottom: 30px;
        }

        ul.features-list li {
            background-color: var(--bg-light);
            padding: 15px 25px;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow-light);
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid var(--primary-color);
        }
        body.dark ul.features-list li {
             background-color: var(--card-bg-dark); /* Match card bg in dark */
        }
        ul.features-list li:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px var(--shadow-light);
        }

        /* Forms */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"] {
            background-color: var(--card-bg-light);
            border: 1px solid var(--border-color-light);
            border-radius: 8px;
            padding: 14px 18px;
            font-size: 16px;
            color: var(--text-color-light);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
        }
        body.dark input[type="text"],
        body.dark input[type="email"],
        body.dark input[type="password"] {
            background-color: var(--bg-dark);
            color: var(--text-color-dark);
            border-color: var(--border-color-dark);
        }


        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.25);
        }

        input[type="submit"].form-submit-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        input[type="submit"].form-submit-button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }

        .button-google-auth { /* Changed from .button-google to be more generic */
            background-color: var(--google-button-bg); /* Use new variable */
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .button-google-auth:hover {
            background-color: var(--google-button-hover); /* Use new variable */
            transform: translateY(-2px);
        }

        .button-google-auth img {
            height: 24px;
            width: 24px;
        }

        /* Dark Mode Toggle */
        .toggle-dark {
            position: relative;
            display: inline-block;
            width: 55px;
            height: 30px;
            border-radius: 30px;
            background-color: var(--border-color-light);
            cursor: pointer;
            transition: background-color 0.3s ease;
            vertical-align: middle;
            margin-left: 20px;
            border: none;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        body.dark .toggle-dark {
            background-color: var(--border-color-dark);
        }

        .toggle-dark input {
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
            left: -9999px;
        }

        .toggle-thumb {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            border-radius: 50%;
            transition: left 0.3s ease, background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        body.dark .toggle-thumb {
            background-color: #f0f0f0; /* Light thumb on dark checked */
        }


        .toggle-dark input:checked + .toggle-thumb {
            left: 28px;
            transform: rotate(360deg);
        }


        /* Footer */
        footer {
            width: 100%;
            padding: 20px;
            text-align: center;
            background-color: var(--header-bg-light);
            color: var(--text-color-light);
            font-size: 14px;
            margin-top: auto;
            box-shadow: 0 -2px 8px var(--shadow-light);
            border-top: 1px solid var(--border-color-light);
        }
        body.dark footer {
            background-color: var(--header-bg-dark);
            color: var(--text-color-dark);
            border-top-color: var(--border-color-dark);
        }


        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 15px 20px;
                text-align: center;
            }
            header .logo-container {
                margin-bottom: 15px;
            }
            nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            nav a {
                margin: 0 15px 10px;
            }
            header h1.site-title {
                font-size: 24px;
            }
            main {
                margin: 20px auto;
                padding: 20px 15px;
            }
            h2.section-heading {
                font-size: 28px;
                margin-bottom: 25px;
            }
            ul.features-list li {
                padding: 12px 18px;
            }
        }

        @media (max-width: 480px) {
            header img.logo {
                height: 50px;
            }
            header h1.site-title {
                font-size: 20px;
            }
            nav a {
                margin: 0 10px 8px;
                font-size: 14px;
            }
            main {
                padding: 15px;
                margin: 15px;
            }
            h2.section-heading {
                font-size: 24px;
            }
            p, ul.features-list li, input {
                font-size: 15px;
            }
            input[type="submit"].form-submit-button, .button-google-auth {
                padding: 12px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="logo-container">
        <img src="logo.jpg" alt="Blood Link Logo" class="logo" />
        <h1 class="site-title">Blood Link</h1>
    </div>
    <nav>
        <a href="#" id="link-about" class="active-nav-link">About Us</a>
        <a href="#" id="link-login">Log In</a>
        <a href="#" id="link-signup">Sign Up</a>
        <label class="toggle-dark" for="darkToggle" aria-label="Toggle dark mode">
            <input type="checkbox" id="darkToggle" />
            <span class="toggle-thumb"></span>
        </label>
    </nav>
</header>

<main>
    <section id="about" class="active">
        <h2 class="section-heading">About Blood Link</h2>
        <h3><strong>ğŸ©¸ Our Purpose:</strong></h3>
        <p>At <strong>Blood Link</strong>, we connect compassionate blood donors with those in critical need. Our platform is designed to streamline the process of finding and donating blood, making it easier for lifesavers and recipients to find each other quickly and efficiently.</p>

        <h3><strong>âœ¨ Our Vision:</strong></h3>
        <p>We envision a world where no life is lost due to the unavailability of blood. Blood Link aims to build a strong, community-driven network that ensures timely access to safe blood for everyone, fostering a culture of voluntary blood donation.</p>

        <h3><strong>ğŸ’¡ Why Use Blood Link?</strong></h3>
        <ul class="features-list">
            <li><strong>Quick Donor Search:</strong> Easily find registered donors by blood group and location.</li>
            <li><strong>Simple Registration:</strong> Become a voluntary donor in a few simple steps.</li>
            <li><strong>Community Impact:</strong> Be part of a life-saving network and make a tangible difference.</li>
            <li><strong>Always Accessible:</strong> Our platform is here to help bridge the gap, 24/7.</li>
        </ul>
        <p>Join us in this vital mission. Whether you wish to donate or need to find a donor, Blood Link is your trusted partner. Your single act of kindness can save multiple lives. â¤ï¸</p>
    </section>

    <section id="login" style="display:none;">
        <h2 class="section-heading">Log In to Your Account</h2>
        <form id="loginForm" autocomplete="off">
            <input type="email" id="loginEmail" placeholder="Email" required />
            <input type="password" id="loginPassword" placeholder="Password" required />
            <input type="submit" value="Log In" class="form-submit-button" />
        </form>
        <div style="text-align: center; margin: 20px 0; color: var(--text-color-light);">OR</div>
        <button type="button" class="button-google-auth" id="googleSignInBtnLogin">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
            Sign in with Google
        </button>
    </section>

    <section id="signup" style="display:none;">
        <h2 class="section-heading">Create Your Account</h2>
        <form id="signupForm" autocomplete="off">
            <input type="text" id="signupName" placeholder="Full Name" required />
            <input type="email" id="signupEmail" placeholder="Email" required />
            <input type="password" id="signupPassword" placeholder="Password (min. 6 characters)" required />
            <input type="submit" value="Sign Up" class="form-submit-button" />
        </form>
        <div style="text-align: center; margin: 20px 0; color: var(--text-color-light);">OR</div>
        <button type="button" class="button-google-auth" id="googleSignInBtnSignup">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
            Sign up with Google
        </button>
    </section>
</main>

<footer>
    &copy; <span id="footerYear"></span> All rights reserved to Blood Link.
    <script>document.getElementById('footerYear').textContent = new Date().getFullYear();</script>
</footer>

<script type="module">
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
Â  Â  import { getDatabase, ref, push, set, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
Â  Â  import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

Â  Â  // --- Firebase Configuration ---
Â  Â  const firebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyCWjeZwrqCwe5NWN-Pdm5GPkp1_qJrCuSU",
Â  Â  Â  Â  authDomain: "bloodlink-278a4.firebaseapp.com",
Â  Â  Â  Â  databaseURL: "https://bloodlink-278a4-default-rtdb.firebaseio.com", // Updated this line for Realtime Database URL
Â  Â  Â  Â  projectId: "bloodlink-278a4",
Â  Â  Â  Â  storageBucket: "bloodlink-278a4.firebasestorage.app",
Â  Â  Â  Â  messagingSenderId: "88657445618",
Â  Â  Â  Â  appId: "1:88657445618:web:90999baf48e9718ff5466b",
Â  Â  Â  Â  measurementId: "G-XQGB69C3TP"
Â  Â  };

Â  Â  // Initialize Firebase
Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  const database = getDatabase(app);
Â  Â  const auth = getAuth(app);
Â  Â  const googleProvider = new GoogleAuthProvider();

Â  Â  // Section navigation
Â  Â  const aboutSection = document.getElementById('about');
Â  Â  const loginSection = document.getElementById('login');
Â  Â  const signupSection = document.getElementById('signup');

Â  Â  const navLinkAbout = document.getElementById('link-about');
Â  Â  const navLinkLogin = document.getElementById('link-login');
Â  Â  const navLinkSignup = document.getElementById('link-signup');
Â  Â  const allNavLinks = [navLinkAbout, navLinkLogin, navLinkSignup];


Â  Â  function showSection(sectionToShow, activeNavLink) {
Â  Â  Â  Â  [aboutSection, loginSection, signupSection].forEach(s => {
Â  Â  Â  Â  Â  Â  if (s) {
Â  Â  Â  Â  Â  Â  Â  Â  s.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  s.classList.remove('active');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  allNavLinks.forEach(link => {
Â  Â  Â  Â  Â  Â  if (link) link.classList.remove('active-nav-link');
Â  Â  Â  Â  });

Â  Â  Â  Â  if (sectionToShow) {
Â  Â  Â  Â  Â  Â  sectionToShow.style.display = 'block';
Â  Â  Â  Â  Â  Â  // Trigger reflow for animation
Â  Â  Â  Â  Â  Â  void sectionToShow.offsetWidth;
Â  Â  Â  Â  Â  Â  sectionToShow.classList.add('active');
Â  Â  Â  Â  }
Â  Â  Â  Â  if (activeNavLink) {
Â  Â  Â  Â  Â  Â  activeNavLink.classList.add('active-nav-link');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  if (navLinkAbout) {
Â  Â  Â  Â  navLinkAbout.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  showSection(aboutSection, navLinkAbout);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  if (navLinkLogin) {
Â  Â  Â  Â  navLinkLogin.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  showSection(loginSection, navLinkLogin);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  if (navLinkSignup) {
Â  Â  Â  Â  navLinkSignup.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  showSection(signupSection, navLinkSignup);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Dark mode toggle
Â  Â  const darkToggle = document.getElementById('darkToggle');

Â  Â  function applyDarkMode(isDark) {
Â  Â  Â  Â  if (isDark) {
Â  Â  Â  Â  Â  Â  document.body.classList.add('dark');
Â  Â  Â  Â  Â  Â  if (darkToggle) darkToggle.checked = true;
Â  Â  Â  Â  Â  Â  localStorage.setItem('bloodLinkDarkMode', 'enabled'); // Unique key for this app
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.body.classList.remove('dark');
Â  Â  Â  Â  Â  Â  if (darkToggle) darkToggle.checked = false;
Â  Â  Â  Â  Â  Â  localStorage.removeItem('bloodLinkDarkMode');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Initialize toggle state from localStorage on page load
Â  Â  applyDarkMode(localStorage.getItem('bloodLinkDarkMode') === 'enabled');

Â  Â  if (darkToggle) {
Â  Â  Â  Â  darkToggle.addEventListener('change', () => {
Â  Â  Â  Â  Â  Â  applyDarkMode(darkToggle.checked);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Function to handle user data saving to Firebase Realtime Database
Â  Â  async function saveUserToDatabase(uid, name, email, password = null) {
Â  Â  Â  Â  const userRef = ref(database, 'users/' + uid);
Â  Â  Â  Â  const snapshot = await get(userRef);

Â  Â  Â  Â  if (!snapshot.exists()) {
Â  Â  Â  Â  Â  Â  // User does not exist, create new entry
Â  Â  Â  Â  Â  Â  await set(userRef, {
Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  Â  Â  Â  password: password, // Only for email/password signup. For Google, this will be null.
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: Date.now() // Use client-side timestamp for simplicity, Firebase ServerValue.TIMESTAMP is better for server-side
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  console.log("User data saved to Realtime Database.");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log("User already exists in Realtime Database.");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Signup form logic (Email/Password)
Â  Â  const signupForm = document.getElementById('signupForm');
Â  Â  if (signupForm) {
Â  Â  Â  Â  signupForm.addEventListener('submit', async function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const nameInput = document.getElementById('signupName');
Â  Â  Â  Â  Â  Â  const emailInput = document.getElementById('signupEmail');
Â  Â  Â  Â  Â  Â  const passwordInput = document.getElementById('signupPassword');

Â  Â  Â  Â  Â  Â  if (!nameInput || !emailInput || !passwordInput) return;

Â  Â  Â  Â  Â  Â  const name = nameInput.value.trim();
Â  Â  Â  Â  Â  Â  const email = emailInput.value.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  const password = passwordInput.value;

Â  Â  Â  Â  Â  Â  if (!name || !email || !password) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('All fields are required.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (password.length < 6) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Password must be at least 6 characters long.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Check if user with this email already exists in our 'users' node
Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await get(query(ref(database, 'users'), orderByChild('email'), equalTo(email)));
Â  Â  Â  Â  Â  Â  Â  Â  if (snapshot.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('User with this email already exists. Please log in or use a different email.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // For simplicity, we're directly storing password. In a real app, use Firebase Auth's createUserWithEmailAndPassword
Â  Â  Â  Â  Â  Â  Â  Â  // and then store additional profile data in Realtime DB linked by UID.
Â  Â  Â  Â  Â  Â  Â  Â  const newRef = push(ref(database, 'users'));
Â  Â  Â  Â  Â  Â  Â  Â  await set(newRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  password: password, // WARNING: In a real application, hash passwords!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  alert('Account created successfully! Please log in.');
Â  Â  Â  Â  Â  Â  Â  Â  this.reset();
Â  Â  Â  Â  Â  Â  Â  Â  showSection(loginSection, navLinkLogin);

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error creating user:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert('Failed to create account: ' + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Login form logic with redirect (Email/Password)
Â  Â  const loginForm = document.getElementById('loginForm');
Â  Â  if (loginForm) {
Â  Â  Â  Â  loginForm.addEventListener('submit', async function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const emailInput = document.getElementById('loginEmail');
Â  Â  Â  Â  Â  Â  const passwordInput = document.getElementById('loginPassword');

Â  Â  Â  Â  Â  Â  if (!emailInput || !passwordInput) return;

Â  Â  Â  Â  Â  Â  const email = emailInput.value.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  const password = passwordInput.value;

Â  Â  Â  Â  Â  Â  if (!email || !password) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Email and password are required.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Authenticate user against Firebase Realtime Database
Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await get(query(ref(database, 'users'), orderByChild('email'), equalTo(email)));

Â  Â  Â  Â  Â  Â  Â  Â  if (!snapshot.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Invalid email or password.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  let userFound = false;
Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach(childSnapshot => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = childSnapshot.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // IMPORTANT: In a real application, compare hashed passwords
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user.password === password) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Welcome back, ${user.name}! Redirecting to the Blood Link app...`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sessionStorage.setItem('bloodLinkLoggedInUser', JSON.stringify({name: user.name, email: user.email, uid: childSnapshot.key}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'homepage.html'; // Redirect to the main application
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userFound = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (!userFound) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Invalid email or password.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error during login:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert('An error occurred during login. Please try again.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Google Sign-In/Sign-Up Logic
Â  Â  // Select all buttons with the class 'button-google-auth'
Â  Â  const googleAuthButtons = document.querySelectorAll('.button-google-auth');

Â  Â  googleAuthButtons.forEach(button => {
Â  Â  Â  Â  button.addEventListener('click', async () => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const result = await signInWithPopup(auth, googleProvider);
Â  Â  Â  Â  Â  Â  Â  Â  // The signed-in user info.
Â  Â  Â  Â  Â  Â  Â  Â  const user = result.user;

Â  Â  Â  Â  Â  Â  Â  Â  // Save user data to Realtime Database. This function checks if user exists.
Â  Â  Â  Â  Â  Â  Â  Â  await saveUserToDatabase(user.uid, user.displayName, user.email);

Â  Â  Â  Â  Â  Â  Â  Â  alert(`Welcome, ${user.displayName}! Redirecting to the Blood Link app...`);
Â  Â  Â  Â  Â  Â  Â  Â  sessionStorage.setItem('bloodLinkLoggedInUser', JSON.stringify({name: user.displayName, email: user.email, uid: user.uid}));
Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'homepage.html'; // Redirect to the main application

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  // Handle Errors here.
Â  Â  Â  Â  Â  Â  Â  Â  const errorCode = error.code;
Â  Â  Â  Â  Â  Â  Â  Â  const errorMessage = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  // The email of the user's account used.
Â  Â  Â  Â  Â  Â  Â  Â  const email = error.email;
Â  Â  Â  Â  Â  Â  Â  Â  // The AuthCredential type that was used.
Â  Â  Â  Â  Â  Â  Â  Â  const credential = GoogleAuthProvider.credentialFromError(error);

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Google Sign-In Error:", errorCode, errorMessage, email, credential);
Â  Â  Â  Â  Â  Â  Â  Â  if (errorCode === 'auth/popup-closed-by-user') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // User closed the popup, do nothing or show a subtle message
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Google Sign-In popup closed by user.");
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Google Sign-In failed: ' + errorMessage);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  });


Â  Â  // Show about section on load by default
Â  Â  showSection(aboutSection, navLinkAbout);
</script><script type="module">
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
Â  Â  import { getDatabase, ref, push, set, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
Â  Â  import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

Â  Â  // --- Firebase Configuration ---
Â  Â  const firebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyCWjeZwrqCwe5NWN-Pdm5GPkp1_qJrCuSU",
Â  Â  Â  Â  authDomain: "bloodlink-278a4.firebaseapp.com",
Â  Â  Â  Â  databaseURL: "https://bloodlink-278a4-default-rtdb.firebaseio.com", // Updated this line for Realtime Database URL
Â  Â  Â  Â  projectId: "bloodlink-278a4",
Â  Â  Â  Â  storageBucket: "bloodlink-278a4.firebasestorage.app",
Â  Â  Â  Â  messagingSenderId: "88657445618",
Â  Â  Â  Â  appId: "1:88657445618:web:90999baf48e9718ff5466b",
Â  Â  Â  Â  measurementId: "G-XQGB69C3TP"
Â  Â  };

Â  Â  // Initialize Firebase
Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  const database = getDatabase(app);
Â  Â  const auth = getAuth(app);
Â  Â  const googleProvider = new GoogleAuthProvider();

Â  Â  // Section navigation
Â  Â  const aboutSection = document.getElementById('about');
Â  Â  const loginSection = document.getElementById('login');
Â  Â  const signupSection = document.getElementById('signup');

Â  Â  const navLinkAbout = document.getElementById('link-about');
Â  Â  const navLinkLogin = document.getElementById('link-login');
Â  Â  const navLinkSignup = document.getElementById('link-signup');
Â  Â  const allNavLinks = [navLinkAbout, navLinkLogin, navLinkSignup];


Â  Â  function showSection(sectionToShow, activeNavLink) {
Â  Â  Â  Â  [aboutSection, loginSection, signupSection].forEach(s => {
Â  Â  Â  Â  Â  Â  if (s) {
Â  Â  Â  Â  Â  Â  Â  Â  s.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  s.classList.remove('active');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  allNavLinks.forEach(link => {
Â  Â  Â  Â  Â  Â  if (link) link.classList.remove('active-nav-link');
Â  Â  Â  Â  });

Â  Â  Â  Â  if (sectionToShow) {
Â  Â  Â  Â  Â  Â  sectionToShow.style.display = 'block';
Â  Â  Â  Â  Â  Â  // Trigger reflow for animation
Â  Â  Â  Â  Â  Â  void sectionToShow.offsetWidth;
Â  Â  Â  Â  Â  Â  sectionToShow.classList.add('active');
Â  Â  Â  Â  }
Â  Â  Â  Â  if (activeNavLink) {
Â  Â  Â  Â  Â  Â  activeNavLink.classList.add('active-nav-link');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  if (navLinkAbout) {
Â  Â  Â  Â  navLinkAbout.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  showSection(aboutSection, navLinkAbout);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  if (navLinkLogin) {
Â  Â  Â  Â  navLinkLogin.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  showSection(loginSection, navLinkLogin);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  if (navLinkSignup) {
Â  Â  Â  Â  navLinkSignup.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  showSection(signupSection, navLinkSignup);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Dark mode toggle
Â  Â  const darkToggle = document.getElementById('darkToggle');

Â  Â  function applyDarkMode(isDark) {
Â  Â  Â  Â  if (isDark) {
Â  Â  Â  Â  Â  Â  document.body.classList.add('dark');
Â  Â  Â  Â  Â  Â  if (darkToggle) darkToggle.checked = true;
Â  Â  Â  Â  Â  Â  localStorage.setItem('bloodLinkDarkMode', 'enabled'); // Unique key for this app
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.body.classList.remove('dark');
Â  Â  Â  Â  Â  Â  if (darkToggle) darkToggle.checked = false;
Â  Â  Â  Â  Â  Â  localStorage.removeItem('bloodLinkDarkMode');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Initialize toggle state from localStorage on page load
Â  Â  applyDarkMode(localStorage.getItem('bloodLinkDarkMode') === 'enabled');

Â  Â  if (darkToggle) {
Â  Â  Â  Â  darkToggle.addEventListener('change', () => {
Â  Â  Â  Â  Â  Â  applyDarkMode(darkToggle.checked);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Function to handle user data saving to Firebase Realtime Database
Â  Â  async function saveUserToDatabase(uid, name, email, password = null) {
Â  Â  Â  Â  const userRef = ref(database, 'users/' + uid);
Â  Â  Â  Â  const snapshot = await get(userRef);

Â  Â  Â  Â  if (!snapshot.exists()) {
Â  Â  Â  Â  Â  Â  // User does not exist, create new entry
Â  Â  Â  Â  Â  Â  await set(userRef, {
Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  Â  Â  Â  password: password, // Only for email/password signup. For Google, this will be null.
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: Date.now() // Use client-side timestamp for simplicity, Firebase ServerValue.TIMESTAMP is better for server-side
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  console.log("User data saved to Realtime Database.");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log("User already exists in Realtime Database.");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Signup form logic (Email/Password)
Â  Â  const signupForm = document.getElementById('signupForm');
Â  Â  if (signupForm) {
Â  Â  Â  Â  signupForm.addEventListener('submit', async function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const nameInput = document.getElementById('signupName');
Â  Â  Â  Â  Â  Â  const emailInput = document.getElementById('signupEmail');
Â  Â  Â  Â  Â  Â  const passwordInput = document.getElementById('signupPassword');

Â  Â  Â  Â  Â  Â  if (!nameInput || !emailInput || !passwordInput) return;

Â  Â  Â  Â  Â  Â  const name = nameInput.value.trim();
Â  Â  Â  Â  Â  Â  const email = emailInput.value.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  const password = passwordInput.value;

Â  Â  Â  Â  Â  Â  if (!name || !email || !password) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('All fields are required.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (password.length < 6) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Password must be at least 6 characters long.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Check if user with this email already exists in our 'users' node
Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await get(query(ref(database, 'users'), orderByChild('email'), equalTo(email)));
Â  Â  Â  Â  Â  Â  Â  Â  if (snapshot.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('User with this email already exists. Please log in or use a different email.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // For simplicity, we're directly storing password. In a real app, use Firebase Auth's createUserWithEmailAndPassword
Â  Â  Â  Â  Â  Â  Â  Â  // and then store additional profile data in Realtime DB linked by UID.
Â  Â  Â  Â  Â  Â  Â  Â  const newRef = push(ref(database, 'users'));
Â  Â  Â  Â  Â  Â  Â  Â  await set(newRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  password: password, // WARNING: In a real application, hash passwords!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: Date.now()
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  alert('Account created successfully! Please log in.');
Â  Â  Â  Â  Â  Â  Â  Â  this.reset();
Â  Â  Â  Â  Â  Â  Â  Â  showSection(loginSection, navLinkLogin);

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error creating user:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert('Failed to create account: ' + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Login form logic with redirect (Email/Password)
Â  Â  const loginForm = document.getElementById('loginForm');
Â  Â  if (loginForm) {
Â  Â  Â  Â  loginForm.addEventListener('submit', async function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const emailInput = document.getElementById('loginEmail');
Â  Â  Â  Â  Â  Â  const passwordInput = document.getElementById('loginPassword');

Â  Â  Â  Â  Â  Â  if (!emailInput || !passwordInput) return;

Â  Â  Â  Â  Â  Â  const email = emailInput.value.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  const password = passwordInput.value;

Â  Â  Â  Â  Â  Â  if (!email || !password) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Email and password are required.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Authenticate user against Firebase Realtime Database
Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await get(query(ref(database, 'users'), orderByChild('email'), equalTo(email)));

Â  Â  Â  Â  Â  Â  Â  Â  if (!snapshot.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Invalid email or password.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  let userFound = false;
Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach(childSnapshot => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = childSnapshot.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // IMPORTANT: In a real application, compare hashed passwords
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user.password === password) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Welcome back, ${user.name}! Redirecting to the Blood Link app...`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sessionStorage.setItem('bloodLinkLoggedInUser', JSON.stringify({name: user.name, email: user.email, uid: childSnapshot.key}));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'homepage.html'; // Redirect to the main application
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userFound = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (!userFound) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Invalid email or password.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error during login:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert('An error occurred during login. Please try again.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Google Sign-In/Sign-Up Logic
Â  Â  // Select all buttons with the class 'button-google-auth'
Â  Â  const googleAuthButtons = document.querySelectorAll('.button-google-auth');

Â  Â  googleAuthButtons.forEach(button => {
Â  Â  Â  Â  button.addEventListener('click', async () => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const result = await signInWithPopup(auth, googleProvider);
Â  Â  Â  Â  Â  Â  Â  Â  // The signed-in user info.
Â  Â  Â  Â  Â  Â  Â  Â  const user = result.user;

Â  Â  Â  Â  Â  Â  Â  Â  // Save user data to Realtime Database. This function checks if user exists.
Â  Â  Â  Â  Â  Â  Â  Â  await saveUserToDatabase(user.uid, user.displayName, user.email);

Â  Â  Â  Â  Â  Â  Â  Â  alert(`Welcome, ${user.displayName}! Redirecting to the Blood Link app...`);
Â  Â  Â  Â  Â  Â  Â  Â  sessionStorage.setItem('bloodLinkLoggedInUser', JSON.stringify({name: user.displayName, email: user.email, uid: user.uid}));
Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'homepage.html'; // Redirect to the main application

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  // Handle Errors here.
Â  Â  Â  Â  Â  Â  Â  Â  const errorCode = error.code;
Â  Â  Â  Â  Â  Â  Â  Â  const errorMessage = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  // The email of the user's account used.
Â  Â  Â  Â  Â  Â  Â  Â  const email = error.email;
Â  Â  Â  Â  Â  Â  Â  Â  // The AuthCredential type that was used.
Â  Â  Â  Â  Â  Â  Â  Â  const credential = GoogleAuthProvider.credentialFromError(error);

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Google Sign-In Error:", errorCode, errorMessage, email, credential);
Â  Â  Â  Â  Â  Â  Â  Â  if (errorCode === 'auth/popup-closed-by-user') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // User closed the popup, do nothing or show a subtle message
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Google Sign-In popup closed by user.");
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Google Sign-In failed: ' + errorMessage);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  });


Â  Â  // Show about section on load by default
Â  Â  showSection(aboutSection, navLinkAbout);
</script>
</body>
</html>
